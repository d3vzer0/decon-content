id: 80cb5ddb-baf2-4eb2-9751-8f77c072eb4d
name: cve-2019-0808-set-scheduled-task
description: |
  This query was originally published in the threat analytics report, Windows 7 zero-day for CVE-2019-0808
  CVE-2019-0808 is a vulnerability that allows an attacker to escape the Windows security sandbox and run arbitrary code with admin privileges. This vulnerability affects Windows 7, Windows Server 2008, and Windows Server 2008 R2.
  Exploits for CVE-2019-0808 were first observed as part of highly selective attacks using the Nufsys backdoor. Although the Nufsys-associated exploit was first described as a zero-day, the issue has since been patched.
  The following query detects possible CVE-2019-0808 exploitation by reporting scheduled task creation events associated with the Nufsys attacks.
  References:
  https://nvd.nist.gov/vuln/detail/CVE-2019-0808
  https://portal.msrc.microsoft.com/security-guidance/advisory/CVE-2019-0808
requiredDataConnectors:
- connectorId: MicrosoftThreatProtection
  dataTypes:
  - DeviceProcessEvents
tactics:
- Persistence
- Privilege escalation
- Vulnerability
query: |
  //Scheduled task creation 
  DeviceProcessEvents 
  | where Timestamp  > ago(14d) 
  | where FileName =~ "schtasks.exe"  
  | where ProcessCommandLine  contains "highest" and 
  (ProcessCommandLine contains "ecosetup" or 
  ProcessCommandLine contains "spsextserv.exe")
